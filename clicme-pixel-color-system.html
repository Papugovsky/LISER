<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CliC:ME - Skala kolorystyczna</title>
<style>
  :root {
    --bg: #0a0a0f; --fg: #fff; --dim: rgba(255,255,255,0.55); --dimmer: rgba(255,255,255,0.4);
    --faint: rgba(255,255,255,0.35); --ghost: rgba(255,255,255,0.22); --line: rgba(255,255,255,0.06);
    --card-bg: rgba(255,255,255,0.03); --card-border: rgba(255,255,255,0.06);
    --accent: #f59e0b; --green: #10b981; --blue: #3b82f6; --red: #ef4444;
    --mono: 'Courier New', monospace; --sans: system-ui, -apple-system, sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--fg); font-family: var(--sans); padding: 32px 20px 64px; line-height: 1.6; }
  .wrap { max-width: 580px; margin: 0 auto; }

  /* Header */
  .tag { font-size: 10px; font-weight: 800; color: var(--accent); letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 8px; }
  h1 { font-size: 30px; font-weight: 800; letter-spacing: -0.03em; line-height: 1.15; margin-bottom: 6px; }
  h1 .sub { color: rgba(255,255,255,0.28); }
  .date { font-size: 11px; color: var(--ghost); margin-top: 10px; }

  /* Nav */
  .nav { position: sticky; top: 0; z-index: 10; background: linear-gradient(180deg, #0a0a0f 80%, transparent); padding: 12px 0 26px; display: flex; gap: 5px; flex-wrap: wrap; }
  .nav button { background: rgba(255,255,255,0.04); border: 1px solid var(--line); border-radius: 6px; padding: 5px 11px; font-size: 10px; font-weight: 600; color: var(--dimmer); cursor: pointer; font-family: var(--sans); transition: color 0.2s ease, background 0.2s ease; position: relative; overflow: hidden; z-index:0; }
  .nav button::before { content:''; position:absolute; left:0; top:0; bottom:0; width:var(--prog,0%); background:rgba(245,158,11,0.15); transition:width 0.1s linear; pointer-events:none; z-index:-1; border-radius:5px 0 0 5px; }
  .nav button::after { content:''; position:absolute; inset:-1px; border:1.5px solid rgba(245,158,11,0.45); border-radius:7px; clip-path:inset(0 50% 100% 50%); transition:clip-path 0.35s ease; pointer-events:none; z-index:1; }
  .nav button:hover::after { clip-path:inset(0 0 0 0); }
  .nav button:hover { color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.06); }
  .nav button.on { border-color: rgba(245,158,11,0.3); color: var(--accent); background: rgba(255,255,255,0.04); }
  .nav button.on::after { clip-path:inset(0 0 0 0); border-color:rgba(245,158,11,0.5); }
  .tbl-toggle { font-size:11px; font-weight:600; color:rgba(255,255,255,0.35); cursor:pointer; transition:color 0.2s ease; user-select:none; }
  .tbl-toggle:hover { color:rgba(255,255,255,0.6); }
  .tbl-toggle svg { transition:opacity 0.2s ease; }

  /* Sections */
  .sec { margin-bottom: 80px; scroll-margin-top: 110px; }
  .sec-head { display: flex; align-items: baseline; gap: 10px; margin-bottom: 22px; }
  .sec-num { font-size: 11px; font-weight: 700; color: var(--accent); font-family: var(--mono); opacity: 0.7; }
  .sec h2 { font-size: 21px; font-weight: 800; letter-spacing: -0.02em; }

  /* Card */
  .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; padding: 20px; margin-bottom: 16px; }
  .fade-in { opacity:0; transform:translateY(12px); transition:opacity 0.5s ease, transform 0.5s ease; }
  .fade-in.visible { opacity:1; transform:translateY(0); }
  .card.accent { border-color: rgba(245,158,11,0.15); }
  .card.green { border-color: rgba(16,185,129,0.15); }

  /* Label */
  .lbl { font-size: 11px; color: var(--faint); font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 10px; }

  /* Text */
  .tx { font-size: 14px; line-height: 1.9; color: var(--dim); margin-bottom: 14px; }
  .tx:last-child { margin-bottom: 0; }
  b, strong { color: rgba(255,255,255,0.88); font-weight: 700; }
  .toast { position:fixed;background:rgba(30,30,40,0.92);color:rgba(255,255,255,0.75);font-size:11px;font-weight:600;padding:6px 12px;border-radius:6px;opacity:0;transition:opacity 0.25s ease;pointer-events:none;z-index:100;font-family:var(--mono);white-space:nowrap;border:1px solid rgba(255,255,255,0.1);box-shadow:0 4px 12px rgba(0,0,0,0.5); }
  .toast.show { opacity:1; }
  .tbl-cell { cursor:pointer; transition:background 0.15s; border-radius:3px; }
  .tbl-cell:hover { background:rgba(245,158,11,0.08); }
  .tbl-cell span:first-child { transition:transform 0.15s, box-shadow 0.15s; border:1px solid rgba(255,255,255,0.1); }
  .tbl-cell:hover span:first-child { transform:scale(1.15); box-shadow:0 0 6px rgba(245,158,11,0.3); border-color:rgba(245,158,11,0.4); }
  .de-fix { text-transform:none; }
  code { font-family: var(--mono); font-size: 12px; }
  code.hex-copy { cursor:pointer; transition:color 0.2s, text-shadow 0.2s; border-radius:2px; }
  code.hex-copy:hover { color:rgba(245,158,11,0.85); text-shadow:0 0 8px rgba(245,158,11,0.25); }
  .csw { display:inline-block; width:10px; height:10px; border-radius:2px; border:1px solid rgba(255,255,255,0.15); vertical-align:middle; margin-right:3px; cursor:pointer; transition:border-color 0.2s, box-shadow 0.2s; }
  .csw:hover { border-color:rgba(245,158,11,0.6); box-shadow:0 0 6px rgba(245,158,11,0.3); }

  /* Callout */
  .co { border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; font-size: 13px; line-height: 1.75; color: rgba(255,255,255,0.65); }
  .co.blue { background: rgba(59,130,246,0.07); border: 1px solid rgba(59,130,246,0.2); }
  .co.amber { background: rgba(245,158,11,0.07); border: 1px solid rgba(245,158,11,0.2); }
  .co.green { background: rgba(16,185,129,0.07); border: 1px solid rgba(16,185,129,0.2); }
  .co-icon { font-weight: 800; margin-right: 6px; }
  .co.blue .co-icon { color: var(--blue); }
  .co.amber .co-icon { color: var(--accent); }
  .co.green .co-icon { color: var(--green); }

  /* Gradient bar */
  .grad { border-radius: 6px; overflow: hidden; }
  .grad-label { font-size: 10px; color: var(--dimmer); font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; margin-bottom: 4px; }
  .grad-ends { display: flex; justify-content: space-between; margin-top: 4px; font-size: 9px; color: rgba(255,255,255,0.3); font-family: var(--mono); }
  .grad-ends .neutral { font-family: var(--sans); letter-spacing: 0.05em; }

  /* Swatches */
  .sw { display: flex; gap: 1px; margin-bottom: 4px; }
  .sw-item { flex: 1; height: 24px; border-radius: 2px; border: 1px solid rgba(255,255,255,0.04); }
  .sw-label { font-size: 10px; color: var(--faint); font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 3px; }

  /* HueStrip */
  .hue-strip { display: flex; gap: 2px; margin-bottom: 14px; }
  .hue-strip .hs-item { flex: 1; text-align: center; }
  .hue-strip .hs-swatch { height: 28px; border-radius: 3px; }
  .hue-strip .hs-val { font-size: 7px; color: rgba(255,255,255,0.3); margin-top: 2px; font-family: var(--mono); }

  /* ProblemBox */
  .pbox { display: flex; gap: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; padding: 12px 14px; border: 1px solid rgba(255,255,255,0.04); margin-bottom: 8px; }
  .pbox-n { font-size: 18px; font-weight: 800; color: rgba(239,68,68,0.5); min-width: 20px; }
  .pbox-title { font-size: 12.5px; font-weight: 700; color: rgba(255,255,255,0.8); margin-bottom: 3px; }
  .pbox-desc { font-size: 11.5px; color: var(--dimmer); line-height: 1.65; }

  /* Grid helpers */
  .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .grid4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin: 20px 0 8px 0; }
  .stat { text-align: center; padding: 14px; }
  .stat-val { font-size: 24px; font-weight: 800; line-height: 1; }
  .stat-lbl { font-size: 8px; color: var(--faint); margin-top: 5px; text-transform: uppercase; letter-spacing: 0.04em; }

  /* Small label */
  .micro { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 3px; }
  .micro.red { color: rgba(239,68,68,0.6); }
  .micro.green { color: rgba(16,185,129,0.6); }
  .micro.dim { color: rgba(255,255,255,0.3); }

  /* Green feature box */
  .feat { padding: 10px 12px; background: rgba(16,185,129,0.04); border-radius: 8px; border: 1px solid rgba(16,185,129,0.1); }
  .feat-title { font-size: 11.5px; font-weight: 700; color: rgba(16,185,129,0.8); margin-bottom: 3px; }
  .feat-desc { font-size: 11px; color: rgba(255,255,255,0.45); line-height: 1.5; }

  /* Blue/Red zone boxes */
  .zone-blue { padding: 10px 12px; background: rgba(59,130,246,0.06); border-radius: 8px; border: 1px solid rgba(59,130,246,0.1); }
  .zone-blue .zt { font-size: 10px; font-weight: 700; color: rgba(96,165,250,0.8); margin-bottom: 4px; }
  .zone-red { padding: 10px 12px; background: rgba(239,68,68,0.06); border-radius: 8px; border: 1px solid rgba(239,68,68,0.1); }
  .zone-red .zt { font-size: 10px; font-weight: 700; color: rgba(248,113,113,0.8); margin-bottom: 4px; }
  .zone-val { font-size: 10px; color: var(--dimmer); line-height: 1.5; }

  /* Gray comparison */
  .gray-compare { display: flex; gap: 12px; margin-bottom: 12px; }
  .gray-box { flex: 1; background: var(--card-bg); border-radius: 10px; padding: 14px; display: flex; gap: 10px; align-items: center; }
  .gray-box.after { border: 1px solid rgba(16,185,129,0.15); }
  .gray-box.before { border: 1px solid var(--card-border); }
  .gray-swatch { width: 42px; height: 42px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); flex-shrink: 0; }

  /* Zone list in result */
  .zone-row { display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
  .zone-row:last-child { border-bottom: none; }
  .zone-dot { width: 8px; height: 8px; border-radius: 4px; margin-top: 5px; flex-shrink: 0; }

  /* Footer */
  .footer { text-align: center; padding: 28px 0 0; border-top: 1px solid var(--line); font-size: 10px; color: rgba(255,255,255,0.18); line-height: 1.7; }

  /* dE bar legend */
  .legend { display: flex; gap: 12px; margin-top: 6px; }
  .legend-item { display: flex; align-items: center; gap: 4px; }
  .legend-dot { width: 8px; height: 8px; border-radius: 2px; }
  .legend-text { font-size: 9px; color: var(--faint); }

  .small-note { font-size: 11px; color: var(--dimmer); line-height: 1.6; margin-top: 6px; }
  .note-10 { font-size: 10px; color: var(--faint); line-height: 1.5; margin-top: 6px; }
</style>
</head>
<body>
<div class="wrap">

  <!-- HEADER -->
  <div style="margin-bottom:36px">
    <div class="tag">CliC:ME Dashboard - Color System</div>
    <h1>Skala kolorystyczna<br><span class="sub">dla map na dashboardzie</span></h1>
    <div class="date">Analiza i uzasadnienie przyjętych założeń kolorystycznych - Made by <a href="https://autentika.com" style="color:rgba(255,255,255,0.45);text-decoration:underline;text-underline-offset:2px" target="_blank">Autentika</a></div>
  </div>

  <!-- NAV -->
  <div class="nav" id="nav"></div>

  <!-- ===== 01 ===== -->
  <div class="sec" id="proposals">
    <div class="sec-head"><span class="sec-num">01</span><h2>Propozycje kolorystyczne LISER</h2></div>

    <p class="tx">Dashboard CliC:ME potrzebuje nowej skali kolorystycznej, odpowiadającej rosnącym wymaganiom stawianym przed projektem. Punktem wyjścia było uzgodnienie, że obecna paleta zastosowana w pilocie jest niewystarczająca. Na stole pojawiły się cztery warianty skali dywergentnej, oparte na podstawowych kolorach brandowych: brand navy <span style="white-space:nowrap"><span class="csw" style="background:#000066"></span>&nbsp;<code>#000066</code></span> i brand red <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span>, z neutral grey <span style="white-space:nowrap"><span class="csw" style="background:#D9D9D9"></span>&nbsp;<code>#D9D9D9</code></span> jako punktem zerowym. Poszczególne warianty różnią się liczbą i doborem dodatkowych punktów kontrolnych. Poniżej przegląd każdego z nich.</p>

    <div class="co amber"><span class="co-icon">!</span> Oryginalna specyfikacja LISER opisuje ostatni step czerwony w VS-02, VS-03 i VS-03 exp jako <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span>, ale wizualnie jest to wyraźnie ciemniejszy bordowy. Przyjmujemy wartość odczytaną z grafiki: <span style="white-space:nowrap"><span class="csw" style="background:#8D1C0C"></span>&nbsp;<code>#8D1C0C</code></span>.</div>

    <div class="card">
      <div class="lbl">VS-01 - 2 brand colors + grey</div>
      <div class="grad" id="g-vs01" style="height:24px;margin-bottom:6px"></div>
      <div style="font-size:11px;color:var(--dimmer);line-height:1.6">Trzy punkty kontrolne: <span style="white-space:nowrap"><span class="csw" style="background:#000066"></span>&nbsp;<code>#000066</code></span> brand navy, <span style="white-space:nowrap"><span class="csw" style="background:#D9D9D9"></span>&nbsp;<code>#D9D9D9</code></span> neutral grey, <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span> brand red. Minimalna konfiguracja divergent scale.</div>
    </div>

    <div class="card">
      <div class="lbl">VS-02 - 4 brand colors + grey</div>
      <div class="grad" id="g-vs02" style="height:24px;margin-bottom:6px"></div>
      <div style="font-size:11px;color:var(--dimmer);line-height:1.6">Pięć punktów: <span style="white-space:nowrap"><span class="csw" style="background:#000066"></span>&nbsp;<code>#000066</code></span> brand navy, <span style="white-space:nowrap"><span class="csw" style="background:#0099FF"></span>&nbsp;<code>#0099FF</code></span> sky blue, <span style="white-space:nowrap"><span class="csw" style="background:#D9D9D9"></span>&nbsp;<code>#D9D9D9</code></span> neutral grey, <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span> brand red, <span style="white-space:nowrap"><span class="csw" style="background:#8D1C0C"></span>&nbsp;<code>#8D1C0C</code></span> dark red. Obie strony mają punkt kontrolny w mid-zone: sky blue po stronie ujemnej, brand red po stronie dodatniej. Krawędzie wyznaczają navy i dark red.</div>
    </div>

    <div class="card">
      <div class="lbl">VS-03 - 4 brand + teal + pink</div>
      <div class="grad" id="g-vs03" style="height:24px;margin-bottom:6px"></div>
      <div style="font-size:11px;color:var(--dimmer);line-height:1.6">Wariant z tealowym akcentem <span style="white-space:nowrap"><span class="csw" style="background:#73E6D0"></span>&nbsp;<code>#73E6D0</code></span> i różowym <span style="white-space:nowrap"><span class="csw" style="background:#E673AB"></span>&nbsp;<code>#E673AB</code></span> w strefie bliskiej szaremu. Rozszerza gamę odcieni w jasnej strefie skali.</div>
    </div>

    <div class="card">
      <div class="lbl">VS-03 exp - cyan + magenta na skrajach</div>
      <div class="grad" id="g-vs03exp" style="height:24px;margin-bottom:6px"></div>
      <div style="font-size:11px;color:var(--dimmer);line-height:1.6">Wariant eksperymentalny z cyan <span style="white-space:nowrap"><span class="csw" style="background:#00EDBF"></span>&nbsp;<code>#00EDBF</code></span> i magenta <span style="white-space:nowrap"><span class="csw" style="background:#FF3BA2"></span>&nbsp;<code>#FF3BA2</code></span> jako skrajnymi punktami skali.</div>
    </div>

    <p class="tx">Każdy z wariantów wnosi konkretną wartość do dyskusji. Poniżej analiza, który z nich najlepiej spełnia wymagania kartograficzne.</p>
  </div>

  <!-- ===== 02 ===== -->
  <div class="sec" id="vs02">
    <div class="sec-head"><span class="sec-num">02</span><h2>Dlaczego VS-02 jako baza</h2></div>

    <p class="tx">Spośród czterech wariantów, VS-02 okazał się jedynym, który łączy wystarczającą kontrolę nad gradacjami z zachowaniem intuicyjnej czytelności skali dywergentnej.</p>

    <div class="card">
      <div class="lbl">VS-01: niewystarczająca kontrola</div>
      <div class="grad" id="g-vs01b" style="height:20px;margin-bottom:10px"></div>
      <p class="tx">Tylko dwa punkty kolorystyczne i szary pośrodku - zbyt mało, by zapewnić kontrolę nad granulacją skali. Interpolacja RGB między brand navy a grey generuje brudne fiolety w strefie L*=30-60, a cała skala ma silną inklinację w kierunku szarego: większość wartości pośrednich wypada jako blade, mało nasycone tony. Brak punktu kontrolnego w strefie mid-blue uniemożliwia sterowanie przejściem kolorystycznym tam, gdzie na mapie gromadzi się najwięcej danych.</p>
    </div>

    <div class="card accent">
      <div class="lbl">VS-03 / VS-03 exp: problem z odczytem polaryzacji</div>
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <div style="flex:1"><div class="micro dim">VS-03</div><div class="grad" id="g-vs03b" style="height:20px"></div></div>
        <div style="flex:1"><div class="micro dim">VS-03 EXP</div><div class="grad" id="g-vs03expb" style="height:20px"></div></div>
      </div>
      <p class="tx">Skala dywergentna opiera się na fundamentalnej konwencji: <strong>chłodne odcienie = wartości ujemne</strong>, <strong>ciepłe odcienie = wartości dodatnie</strong>. Odbiorca intuicyjnie odczytuje temperaturę kolorystyczną bez sięgania do legendy.</p>

      <div class="pbox"><div class="pbox-n">1</div><div><div class="pbox-title">Teal jest kolorem ciepłym</div><div class="pbox-desc">Jasny, nasycony zielonkawy odcień intuicyjnie nie kojarzy się z „minus" / wartość ujemna. Odbiorca widzi jasną plamę i nie wie, czy to strefa bliska zeru, czy ujemna wartość.</div></div></div>
      <div class="pbox"><div class="pbox-n">2</div><div><div class="pbox-title">Róż odsuwa się od osi ciepłej</div><div class="pbox-desc">Pink <span style="white-space:nowrap"><span class="csw" style="background:#E673AB"></span>&nbsp;<code>#E673AB</code></span> jest chłodniejszy niż brand red - przesunięcie w stronę fioletu osłabia odczyt „ciepłe = plus". Użytkownik traci natychmiastową intuicję polaryzacji.</div></div></div>
      <div class="pbox"><div class="pbox-n">3</div><div><div class="pbox-title">VS-03 exp: profil jasności W</div><div class="pbox-desc">Cyan i magenta na skrajach są jasne (L*=87 i L*=56). Ekstrema powinny być najciemniejsze. Jasny region może oznaczać „blisko zera" lub „skrajne minimum" - użytkownik nie odróżni.</div></div></div>

      <div class="co amber"><span class="co-icon">!</span> Dywergentne schematy kolorów w kartografii tematycznej: mapa przedstawia odchylenia od punktu neutralnego (średniej, zera). Dwie kontrastujące barwy z jasnym, neutralnym kolorem pośrodku ułatwiają natychmiastową identyfikację skupisk wysokich lub niskich wartości. Odbiorca musi odczytać <strong>kierunek</strong> (ujemne vs dodatnie) i <strong>intensywność</strong> (słaba vs silna) bez sięgania do legendy. Wieloodcieniowe warianty komplikują ten natychmiastowy odczyt.</div>
    </div>

    <div class="card green">
      <div class="lbl">VS-02: optymalna baza</div>
      <div class="grad" id="g-vs02b" style="height:24px;margin-bottom:12px"></div>
      <div class="grid2" style="gap:12px">
        <div class="feat"><div class="feat-title">Czysta polaryzacja</div><div class="feat-desc">Niebieski = minus, czerwony = plus. Brak odcieni łamiących intuicję. Użytkownik odczytuje kierunek zmiany z samego koloru, bez sięgania do legendy.</div></div>
        <div class="feat"><div class="feat-title">Kontrola mid-zone</div><div class="feat-desc">Obie strony skali mają pośredni punkt kontrolny w mid-zone: <span style="white-space:nowrap"><span class="csw" style="background:#0099FF"></span>&nbsp;<code>#0099FF</code></span> sky blue (L*=62) po stronie ujemnej, <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span> brand red (L*=48) po stronie dodatniej.</div></div>
        <div class="feat"><div class="feat-title">Brand-consistent</div><div class="feat-desc">Oparta wyłącznie na kolorach LISER: brand navy, sky, grey, brand red.</div></div>
        <div class="feat"><div class="feat-title">Rozszerzalna</div><div class="feat-desc">Możliwość dodania ciemniejszych tonów poza brand anchors.</div></div>
      </div>
    </div>

    <div class="card">
      <div class="lbl">Dlaczego 33 stepy zamiast oryginalnych 8</div>
      <p class="tx">Oryginalna 8-krokowa skala zielono-czerwona z interpolacją została zaprojektowana jako rozwiązanie inicjalne dla pilota CliC:ME i realizowała pierwotne założenia. Wraz z dalszym rozwojem dashboardu, feedbackiem użytkowników i rosnącymi potrzebami analitycznymi, stała się niewystarczająca:</p>

      <div class="pbox"><div class="pbox-n">1</div><div><div class="pbox-title">Zbyt duże uogólnienia danych</div><div class="pbox-desc">Osiem stepów to za mało, by oddać różnorodność wartości migracyjnych. Regiony o bardzo różnych wartościach wyświetlały się tym samym kolorem - użytkownik tracił informacje o gradacji zjawiska.</div></div></div>
      <div class="pbox"><div class="pbox-n">2</div><div><div class="pbox-title">Brak neutralnego szarego na wartości bliskie zeru</div><div class="pbox-desc">W 8-stepowej skali nie było wyraźnie wyodrębnionej strefy neutralnej. Wartości bliskie zeru (statystycznie nieistotne) wyświetlały się jako słabo nasycone kolory zamiast czystego szarego - na mapie pojawiał się szum kolorystyczny zamiast wygaszenia środka.</div></div></div>
      <div class="pbox"><div class="pbox-n">3</div><div><div class="pbox-title">Ryzyko dla czytelności przy małej liczbie stepów</div><div class="pbox-desc">Przy 8 stepach każdy skok kolorystyczny jest duży i ostry. Mapa wygląda jak mozaika plam zamiast płynnego obrazu zjawiska. Odbiorca widzi granice między stepami, nie trend.</div></div></div>

      <p class="tx" style="margin-top:14px">Ile stepów potrzebuje skala dywergencyjna z pięcioma anchorami (4 segmenty)? Liczba stepów musi spełniać warunek <strong>4k+1</strong> - tylko wtedy każdy anchor trafia dokładnie na step. Testowaliśmy kolejne dopuszczalne warianty:</p>
      <div style="display:grid;grid-template-columns:auto auto auto auto auto auto;gap:0;font-size:12px;font-family:var(--mono);margin:12px 0 14px;max-width:600px">
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">Steps</div>
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08);white-space:nowrap">Zakres/step<br><span style="font-weight:400;font-size:10px">(precyzja)</span></div>
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">Avg dE</div>
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">Min dE</div>
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08);white-space:nowrap">Niewidoczne<br><span style="font-weight:400;font-size:10px">(dE &lt; 3)</span></div>
        <div style="padding:6px 10px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08);white-space:nowrap">Trudne na mapie<br><span style="font-weight:400;font-size:10px">(dE &lt; 5)</span></div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">13</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±167</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">23.0</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">11.6</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">21</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±100</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">13.9</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">6.8</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">25</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±83</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">11.6</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">5.6</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">29</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±71</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">9.9</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">4.7</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">2</div>

        <div style="padding:5px 10px;color:rgba(245,158,11,0.9);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">33</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.8);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">±62</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.6);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">8.7</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.8);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">4.0</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.8);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">0</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.8);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.03);background:rgba(245,158,11,0.06)">7</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">37</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±56</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">7.7</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">3.6</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">0</div>
        <div style="padding:5px 10px;color:rgba(251,191,36,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">9</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">45</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">±45</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4);border-bottom:1px solid rgba(255,255,255,0.03)">6.3</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">2.7</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">1</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7);border-bottom:1px solid rgba(255,255,255,0.03)">11</div>

        <div style="padding:5px 10px;color:rgba(255,255,255,0.4)">65</div>
        <div style="padding:5px 10px;color:rgba(52,211,153,0.7)">±31</div>
        <div style="padding:5px 10px;color:rgba(255,255,255,0.4)">4.4</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7)">1.9</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7)">16</div>
        <div style="padding:5px 10px;color:rgba(239,68,68,0.7)">46</div>
      </div>
      <p class="small-note" style="color:rgba(255,255,255,0.25);margin-bottom:12px">Wartości dE z naiwnej interpolacji liniowej RGB między anchorami VS-02 - uczciwa baza porównawcza przed korektami hue i LUT.</p>
      <p class="tx">Czytając tabelę od góry: precyzja rośnie z każdym krokiem, ale kolumny dE zaczynają żółknieć i czerwienieć. Od dołu: percepcja jest katastrofalna, ale precyzja świetna. Gdzieś pośrodku te dwa ograniczenia się krzyżują.</p>
      <p class="tx">Przy 13-21 stepach kolory są pięknie rozróżnialne, ale ±100-167 jednostek na step oznacza, że pixel z saldem +50 i pixel z +200 dostają ten sam kolor - różnice w danych znikają w uśrednieniu. Przy 45+ stepach precyzja jest dobra, ale pojawiają się pierwsze pary z dE poniżej 3 - kolory nierozróżnialne okiem na mapie. Przy 65 stepach 16 par jest niewidocznych.</p>
      <p class="tx">Wariant <strong>33</strong> to ostatni poziom, w którym żadna para nie spada poniżej dE 3 przy jednoczesnej precyzji ±62 jednostek - wystarczającej do odczytu trendów przestrzennych na poziomie pojedynczych pixeli. Krok wyżej (37) daje marginalny zysk precyzji (±56 vs ±62), ale 9 par trudnych na mapie zamiast 7. Krok niżej (29) - zero problemów percepcyjnych, ale ±71 to próg, przy którym drobne różnice przestrzenne zaczynają się zacierać.</p>
      <p class="tx">Finalna paleta po korektach hue i LUT ma min dE = 3.4 (idx 22-23, strefa brand red) - szczegóły tego trade-offu w sekcji percepcji kolorów.</p>
    </div>
  </div>

  <!-- ===== 03 ===== -->
  <div class="sec" id="extension">
    <div class="sec-head"><span class="sec-num">03</span><h2>Rozszerzenie zakresu tonalnego</h2></div>

    <div class="card">
      <div class="lbl">Przesunięcie kolorów wyjściowych i rozszerzenie krawędzi</div>
      <p class="tx">VS-02 operuje od brand navy <span style="white-space:nowrap"><span class="csw" style="background:#000066"></span>&nbsp;<code>#000066</code></span> (L*=9) przez sky blue <span style="white-space:nowrap"><span class="csw" style="background:#0099FF"></span>&nbsp;<code>#0099FF</code></span> (L*=62) i neutral grey <span style="white-space:nowrap"><span class="csw" style="background:#D9D9D9"></span>&nbsp;<code>#D9D9D9</code></span> (L*=87), przez brand red <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span> (L*=48) do dark red <span style="white-space:nowrap"><span class="csw" style="background:#8D1C0C"></span>&nbsp;<code>#8D1C0C</code></span> (L*=31). Pierwotnym założeniem było zachowanie tych kolorów brandingowych na skrajach skali. W praktyce okazało się to nieefektywne z dwóch powodów:</p>
      <p class="tx"><strong>Po pierwsze</strong> - wartości ekstremalne stanowią marginalny udział w danych. Większość pixeli na mapie skupia się wokół median i wartości umiarkowanych. Kolory na krawędziach skali pojawiają się rzadko, niezależnie od tego jakie są.</p>
      <p class="tx"><strong>Po drugie</strong> - przy opacity (wymóg dla pixeli) i nałożeniu na baselayer mapy, kolory i tak tracą swoją oryginalną charakterystykę na tyle, że rozpoznawalność brandingowa nie jest realistycznym celem dla skali kartograficznej.</p>
      <p class="tx">Zamiast tego postawiliśmy na <strong>maksymalne nacechowanie krawędzi skali</strong>: wyciągnięcie ekstremalnych stepów w ciemniejsze barwy, znacznie wykraczające poza oryginalną selekcję LISER. Ciemniejsze ekstrema dają silniejszy kontrast wizualny - nawet jeśli pojawiają się rzadko, to gdy się pojawią, natychmiast przyciągają uwagę i sygnalizują wartości skrajne. Kolory wyjściowe LISER (brand navy, brand red) przesunęły się naturalnie w strefę mid-range, gdzie gromadzi się najwięcej danych i gdzie są najczęściej widoczne.</p>
    </div>

    <p class="tx">Mapy dostępne obecnie w ramach dashboardu CliC:ME mają różne rozpiętości danych - na potrzeby opracowania skali przyjęliśmy roboczy zakres od -1000 do +1000. Oryginalna selekcja LISER była zbyt wąska: po rozciągnięciu na 33 stepy <strong>ciemne tony zlewają się percepcyjnie</strong> - po obu stronach skali. Poniżej konkretne problemy i efekt rozszerzenia.</p>
    <div class="card">
      <div class="lbl">Strona niebieska (wartości ujemne)</div>

      <div class="micro red">Problem: zlewanie ciemnych stepów</div>
      <div class="sw-label">Interpolacja VS-02: L*=2, 3, 5, 6, 7, 9</div>
      <div class="sw" id="sw-blue-before"></div>
      <p class="tx">Sześć najciemniejszych stepów mieści się w L*=2-9 - zakresie, w którym rozróżnialność drastycznie spada. Skrajne stepy da się jeszcze wyłapać, ale <strong>na małych kształtach (pixel-level) różnice między sąsiednimi stepami są praktycznie nieczytelne</strong>. Na mapie region o wartości -700 i -900 wymaga wpatrywania się, by dostrzec jakąkolwiek zmianę.</p>

      <div class="micro green" style="margin-top:14px">Po rozszerzeniu</div>
      <div class="sw-label">Stepy 0-9: L*=5, 8, 12, 15, 18, 22, 26, 30, 34, 38</div>
      <div class="sw" id="sw-blue-after"></div>
      <p class="small-note">Rozszerzenie od <span style="white-space:nowrap"><span class="csw" style="background:#000066"></span>&nbsp;<code>#000066</code></span> (L*=9) w dół do <span style="white-space:nowrap"><span class="csw" style="background:#0C0343"></span>&nbsp;<code>#0C0343</code></span> (L*=5), z równomiernym rozkładem co ~3.5 L* na step. Średnia różnica percepcyjna: <strong>dE = 4.9</strong> (zakres 4.1-6.1).</p>
    </div>

    <div class="card">
      <div class="lbl">Strona czerwona (wartości dodatnie)</div>

      <div class="micro red">Problem: za wąski zakres ciemnych tonów</div>
      <div class="sw-label">Ściemnianie od dark red: L*=31, 24, 17, 10, 3, 1</div>
      <div class="sw" id="sw-red-before"></div>
      <p class="tx">Najciemniejszy step LISER <span style="white-space:nowrap"><span class="csw" style="background:#8D1C0C"></span>&nbsp;<code>#8D1C0C</code></span> startuje dopiero z L*=31 - jest już w ciemnym zakresie. Naiwne ściemnianie szybko wpada w nierozróżnialne brunatno-czarne tony. Cały zakres LISER po stronie czerwonej (L*=48→31) to zaledwie 17 jednostek L* - <strong>za mało na 10 stepów</strong>, które powinny pokryć L*=43→10.</p>

      <div class="micro green" style="margin-top:14px">Po rozszerzeniu</div>
      <div class="sw-label">Stepy 23-32: L*=43 w dół do L*=10</div>
      <div class="sw" id="sw-red-after"></div>
      <p class="small-note">Rozszerzenie poza zakres LISER - od brand red <span style="white-space:nowrap"><span class="csw" style="background:#E30613"></span>&nbsp;<code>#E30613</code></span> (L*=48) przez dark red <span style="white-space:nowrap"><span class="csw" style="background:#8D1C0C"></span>&nbsp;<code>#8D1C0C</code></span> (L*=31) aż do <span style="white-space:nowrap"><span class="csw" style="background:#3E040B"></span>&nbsp;<code>#3E040B</code></span> (L*=10). Średnia różnica percepcyjna: <strong>dE = 7.5</strong> (zakres 5.4-8.9).</p>
    </div>
  </div>

  <!-- ===== 04 ===== -->
  <div class="sec" id="perception">
    <div class="sec-head"><span class="sec-num">04</span><h2>Percepcja kolorów i ograniczenia monitora</h2></div>

    <p class="tx">Standardowa przestrzeń RGB, w której operują monitory i przeglądarki, nie jest percepcyjnie równomierna - różnica 10 jednostek w ciemnych tonach wygląda inaczej niż ta sama różnica w jasnych. Dwa kolory „równo oddalone" w RGB mogą wyglądać identycznie lub drastycznie różnie, w zależności od miejsca w przestrzeni. HSL (Hue-Saturation-Lightness) jest lepszy intuicyjnie, ale również nie jest percepcyjnie skalibrowany - „Lightness" w HSL nie odpowiada temu, jak ludzkie oko faktycznie odbiera jasność.</p>

    <p class="tx"><strong>CIE L*a*b*</strong> (1976) to przestrzeń zaprojektowana specjalnie tak, by odległość euklidesowa między dwoma punktami odpowiadała percepcyjnej różnicy widzianej przez człowieka. Jest standardem w kartografii, GIS i kolorystyce przemysłowej właśnie dlatego, że pozwala mierzyć „ile różnicy widzi oko" zamiast „ile różnicy jest w sygnale monitora".</p>

    <div class="card">
      <div class="lbl">Przestrzeń CIE L*a*b* - trzy składowe</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
        <div><div style="font-size:18px;font-weight:800">L*</div><div style="font-size:10px;font-weight:600;color:rgba(255,255,255,0.5);margin-top:4px">Jasność</div><div style="font-size:9.5px;color:var(--faint);line-height:1.5;margin-top:4px">0 = czarny, 100 = biały. Percepcyjnie skalibrowana - różnica L*=10 wygląda „tak samo duża" niezależnie od miejsca na skali. To główna oś rozróżniania na mapie.</div></div>
        <div><div style="font-size:18px;font-weight:800;color:#a78bfa">a*</div><div style="font-size:10px;font-weight:600;color:rgba(255,255,255,0.5);margin-top:4px">Oś zielony–czerwony</div><div style="font-size:9.5px;color:var(--faint);line-height:1.5;margin-top:4px">Wartości ujemne = zielony, dodatnie = czerwony. W połączeniu z b* definiuje odcień i nasycenie (chroma C* = √(a²+b²)).</div></div>
        <div><div style="font-size:18px;font-weight:800;color:#60a5fa">b*</div><div style="font-size:10px;font-weight:600;color:rgba(255,255,255,0.5);margin-top:4px">Oś niebieski–żółty</div><div style="font-size:9.5px;color:var(--faint);line-height:1.5;margin-top:4px">Wartości ujemne = niebieski, dodatnie = żółty. Razem z a* tworzy płaszczyznę chromatyczną; odcień (hue) to kąt w tej płaszczyźnie.</div></div>
      </div>
      <p class="tx" style="margin-top:14px">W praktyce kartograficznej operujemy na pochodnych: <strong>L*</strong> (jasność), <strong>C*</strong> (chroma = nasycenie = odległość od osi szarości) i <strong>h</strong> (hue = odcień w stopniach: 0°=czerwony, 90°=żółty, 180°=cyan, 270°=niebieski). Ten układ LCh jest bardziej intuicyjny przy projektowaniu skali kolorystycznej, bo pozwala niezależnie kontrolować „jak jasne", „jak nasycone" i „jaki odcień".</p>
    </div>

    <div class="card">
      <div class="lbl">Delta E (<span class="de-fix">dE</span>) - mierzalna różnica percepcyjna</div>
      <p class="tx">Skoro CIE L*a*b* jest percepcyjnie równomierna, to odległość euklidesowa między dwoma kolorami w tej przestrzeni (dE = √(ΔL² + Δa² + Δb²)) mówi wprost: <strong>ile różnicy widzi ludzkie oko</strong>. To nie abstrakcyjna metryka - to narzędzie, które pozwala projektować skalę kolorystyczną z gwarancją, że sąsiednie stepy będą rozróżnialne na mapie.</p>
      <div style="display:flex;gap:3px;margin:14px 0 10px">
        <div style="flex:1;padding:8px 6px;background:rgba(255,255,255,0.08);border-radius:6px;text-align:center"><div style="font-size:11px;font-weight:700;color:rgba(255,255,255,0.7)">dE poniżej 1</div><div style="font-size:9px;color:var(--dimmer);margin-top:2px">Niewidoczna</div></div>
        <div style="flex:1;padding:8px 6px;background:rgba(251,191,36,0.15);border-radius:6px;text-align:center"><div style="font-size:11px;font-weight:700;color:rgba(255,255,255,0.7)">dE 1-3</div><div style="font-size:9px;color:var(--dimmer);margin-top:2px">Subtelna</div></div>
        <div style="flex:1;padding:8px 6px;background:rgba(251,191,36,0.3);border-radius:6px;text-align:center"><div style="font-size:11px;font-weight:700;color:rgba(255,255,255,0.7)">dE 3-5</div><div style="font-size:9px;color:var(--dimmer);margin-top:2px">Widoczna</div></div>
        <div style="flex:1;padding:8px 6px;background:rgba(52,211,153,0.3);border-radius:6px;text-align:center"><div style="font-size:11px;font-weight:700;color:rgba(255,255,255,0.7)">dE powyżej 5</div><div style="font-size:9px;color:var(--dimmer);margin-top:2px">Oczywista</div></div>
      </div>
      <p class="tx">Na mapie warunki odczytu są trudniejsze niż przy porównywaniu dwóch kolorów obok siebie: pixele są małe, leżą obok siebie w chaotycznej mozaice, tło kartograficzne przebija przez opacity. Dlatego praktyczny próg rozróżnialności (JND - Just Noticeable Difference) na mapie to <strong>dE około 5</strong>, wyższy niż teoretyczne ~2.5 przy idealnych warunkach. Każdy sąsiedni step naszej skali musi przekraczać ten próg, żeby użytkownik mógł odczytać różnicę intensywności bez porównywania z legendą.</p>

      <div style="margin-top:16px">
        <div style="font-size:9px;font-weight:700;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px">Jak wygląda <span class="de-fix">dE</span> w praktyce - rzeczywiste pary z naszej palety (opacity 0.75 na baselayerze)</div>
        <div style="display:flex;gap:14px;flex-wrap:wrap">
          <div style="flex:1;min-width:140px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06)">
            <div style="display:flex;gap:0;margin-bottom:8px">
              <div style="width:50%;height:40px;background:#e13f47;border-radius:4px 0 0 4px"></div>
              <div style="width:50%;height:40px;background:#dc3f49;border-radius:0 4px 4px 0"></div>
            </div>
            <div style="font-size:13px;font-weight:800;color:rgba(255,255,255,0.7)">dE = 3.4</div>
            <div style="font-size:9px;color:rgba(255,255,255,0.3);margin-top:2px">Sąsiednie stepy mid/dark red (idx 22-23)</div>
            <div style="font-size:9px;color:rgba(239,68,68,0.6);margin-top:4px">Blisko progu widoczności</div>
          </div>
          <div style="flex:1;min-width:140px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06)">
            <div style="display:flex;gap:0;margin-bottom:8px">
              <div style="width:50%;height:40px;background:#40a6f3;border-radius:4px 0 0 4px"></div>
              <div style="width:50%;height:40px;background:#40b6fc;border-radius:0 4px 4px 0"></div>
            </div>
            <div style="font-size:13px;font-weight:800;color:rgba(255,255,255,0.7)">dE = 8.2</div>
            <div style="font-size:9px;color:rgba(255,255,255,0.3);margin-top:2px">Sąsiednie stepy mid blue (idx 12-13)</div>
            <div style="font-size:9px;color:rgba(251,191,36,0.6);margin-top:4px">Widoczna zmiana</div>
          </div>
          <div style="flex:1;min-width:140px;background:rgba(255,255,255,0.03);border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.06)">
            <div style="display:flex;gap:0;margin-bottom:8px">
              <div style="width:50%;height:40px;background:#f38c6c;border-radius:4px 0 0 4px"></div>
              <div style="width:50%;height:40px;background:#ec725d;border-radius:0 4px 4px 0"></div>
            </div>
            <div style="font-size:13px;font-weight:800;color:rgba(255,255,255,0.7)">dE = 11.4</div>
            <div style="font-size:9px;color:rgba(255,255,255,0.3);margin-top:2px">Sąsiednie stepy mid red (idx 19-20)</div>
            <div style="font-size:9px;color:rgba(52,211,153,0.6);margin-top:4px">Wyraźna różnica</div>
          </div>
        </div>
      </div>
      <p class="tx" style="font-size:12px;color:rgba(255,255,255,0.4);margin-top:14px;margin-bottom:0">Strefa idx 21-23 (przejście mid → dark red) to najwęższe gardło palety. W tym zakresie L* spada minimalnie (47→43), a gamut sRGB dla czystych czerwieni jest prawie płaski - chroma jest na maksimum, więc hue shift nie ma jeszcze pola manewru. To świadomy trade-off: utrzymujemy brand red jako anchor mid-zone, kosztem ciaśniejszego przejścia tuż za nim. Reszta dark-red (idx 23-32) jedzie komfortowo z dE 5.4-8.9.</p>
    </div>

    <div class="card">
      <div class="lbl">Gamut sRGB - ograniczenia monitora</div>
      <div style="display:flex;gap:10px;margin-bottom:12px">
        <div class="zone-blue" style="flex:1"><div class="zt">Niebieski (h=270)</div><div class="zone-val">Max chroma spada powyżej L*=60. Przy L*=75: C* zaledwie 42.</div></div>
        <div class="zone-red" style="flex:1"><div class="zt">Czerwony (h=35)</div><div class="zone-val">Szerszy gamut: C*=80+ do L*=55, ale traci poniżej L*=20.</div></div>
      </div>
      <p class="tx">Ta asymetria gamutu bezpośrednio wpływa na naszą skalę. Strona niebieska jest trudniejsza - przy wysokich jasnościach (jasne niebieskie bliżej strefy neutralnej) monitor nie jest w stanie wyświetlić nasyconego niebieskiego. Dlatego w jasnej strefie niebieskiej przesuwamy hue w kierunku cyjan (h=250), gdzie gamut sRGB jest szerszy i pozwala na wyższe C*. Strona czerwona ma więcej przestrzeni - ale w ciemnych tonach (L* poniżej 20) również traci nasycenie, co wymaga kompensacji przez hue shift w kierunku ciepłego brązu (h=22).</p>
    </div>

    <p class="tx">Oba ograniczenia - spadek chroma w jasnych niebieskich i w ciemnych czerwonych - oznaczają, że prosta interpolacja liniowa między punktami LISER nie wystarczy. Konieczne są korekty hue (opisane w sekcji 05), które wykorzystują dostępny gamut maksymalnie, zamiast trzymać się sztywno jednego odcienia na całej długości ramienia skali.</p>

    <p class="tx">Cała optymalizacja skali - dobór jasności, przesunięcia hue, korekty chroma, kalkulacja dE między sąsiednimi stepami - odbywa się w przestrzeni CIE L*a*b*, gdzie odległości percepcyjne są mierzalne i porównywalne. Jednak technologia wyświetlania (monitory, przeglądarki, Mapbox, Leaflet) operuje wyłącznie w przestrzeni sRGB. Dlatego końcowym etapem jest <strong>translacja każdego z 33 stepów z L*a*b* na wartości RGB (hex)</strong>.</p>

    <p class="tx">Translacja ta nie jest bezstratna - gamut sRGB jest mniejszy niż przestrzeń L*a*b*, więc nie każdy kolor zaprojektowany w Lab da się wiernie odwzorować na monitorze. Przy konwersji stosujemy <strong>gamut clipping z zachowaniem jasności L*</strong> jako priorytetu: jeśli dany punkt Lab wypada poza sRGB, redukujemy chroma (nasycenie) przy niezmienionej jasności i odcieniu, tak by przejścia percepcyjne między sąsiednimi stepami były jak najbardziej równomierne w finalnych wartościach hex. Ostateczne kolory palety (<span style="white-space:nowrap"><span class="csw" style="background:#0C0343"></span>&nbsp;<code>#0C0343</code></span> → ... → <span style="white-space:nowrap"><span class="csw" style="background:#3E040B"></span>&nbsp;<code>#3E040B</code></span>) to wynik tej translacji.</p>
  </div>

  <!-- ===== 05 ===== -->
  <div class="sec" id="lut">
    <div class="sec-head"><span class="sec-num">05</span><h2>Wewnętrzne korekty LUT</h2></div>

    <p class="tx">Na bazie VS-02 z rozszerzonym zakresem ciemnych tonów przeprowadziliśmy korekty Look-Up Table, by zmaksymalizować rozróżnialność sąsiadujących stepów.</p>

    <div class="card">
      <div class="lbl">Korekta 1: Hue shift - strona niebieska</div>

      <div class="micro dim">Przed korektą - stały hue ~270 (czysty niebieski)</div>
      <div class="sw" id="sw-lut-blue-before"></div>

      <div class="micro green" style="margin-top:10px">Po korekcie - progresja hue 305° → 250°</div>
      <div class="hue-strip" id="hs-blue-after"></div>

      <p class="tx">Stopniowe przesunięcie odcienia: od 305 (granatowo-fioletowy) w najciemniejszych, przez 285 (cobalt) w środku, do 250 (niebieski z lekkim cyjanem) w najjaśniejszych. Każdy step zyskuje unikatowy odcień - różnice percepcyjne rosną, bo oko rozróżnia zarówno zmianę jasności jak i zmianę odcienia jednocześnie.</p>
      <p class="small-note">Korzyści gamutowe: przy L*=75, przesunięcie z h=270 na h=250 podnosi dostępne C* z 42 do 46. Połączenie z odmiennym odcieniem daje <strong>dE około 11</strong> między sąsiednimi stepami w mid-zone (zamiast ~4 bez korekty).</p>
    </div>

    <div class="card">
      <div class="lbl">Korekta 2: Hue shift - strona czerwona</div>

      <div class="micro dim">Przed korektą - stały hue ~38 (brand red)</div>
      <div class="sw" id="sw-lut-red-before"></div>

      <div class="micro green" style="margin-top:10px">Po korekcie - progresja hue 52° → 22°</div>
      <div class="hue-strip" id="hs-red-after"></div>

      <p class="tx">Od ciepłego pomarańczowego (h=52) w jasnych tonach, przez brand red (h=38), do ciepłego brązu (h=22) w najciemniejszych. Przy niskim L* oko wciąż rozróżnia zmiany odcienia, nawet gdy różnice jasności są minimalne.</p>
    </div>

    <div class="card">
      <div class="lbl">Korekta 3: Neutralny szary</div>
      <div class="gray-compare">
        <div class="gray-box before">
          <div class="gray-swatch" style="background:#D9D9D9"></div>
          <div><div class="micro dim">Przed</div><div style="font-family:var(--mono);font-size:11px;color:rgba(255,255,255,0.65);margin-top:2px">#D9D9D9</div><div style="font-size:9px;color:rgba(255,255,255,0.3)">L*=87</div></div>
        </div>
        <div class="gray-box after">
          <div class="gray-swatch" style="background:#EDEDED"></div>
          <div><div class="micro green">Po korekcie</div><div style="font-family:var(--mono);font-size:11px;color:rgba(255,255,255,0.65);margin-top:2px">#EDEDED</div><div style="font-size:9px;color:rgba(255,255,255,0.3)">L*=94</div></div>
        </div>
      </div>
      <p class="tx">Oryginalny <span style="white-space:nowrap"><span class="csw" style="background:#D9D9D9"></span>&nbsp;<code>#D9D9D9</code></span> (L*=87) na mapie z baselayerem lądu (<span style="white-space:nowrap"><span class="csw" style="background:#fffdfb"></span>&nbsp;<code>#fffdfb</code></span>) i opacity 0.75 dawał brudny, lekko żółtawy ton zamiast czystego neutralu. Po nałożeniu opacity: efektywny kolor na lądzie to L*=91 - zbyt ciemny i wyrazisty jak na strefę wartości bliskich zeru. Korekta do <span style="white-space:nowrap"><span class="csw" style="background:#EDEDED"></span>&nbsp;<code>#EDEDED</code></span> (L*=94) po nałożeniu na baselayer daje efektywne L*=95 - subtelne, ale wciąż odróżnialne od czystego tła mapy. To ważne rozróżnienie: <strong>szary pixel oznacza „tu są dane, ale wartość jest bliska zeru"</strong>, natomiast brak danych to brak pixela - baselayer przebija się w pełni. Dzięki korekcie strefa neutralna jest dyskretna i nie skupia na sobie uwagi, ale pozostaje widoczna jako informacja o pokryciu danych.</p>
    </div>
  </div>

  <!-- ===== 06 ===== -->
  <div class="sec" id="opacity">
    <div class="sec-head"><span class="sec-num">06</span><h2>Opacity i warstwa bazowa mapy</h2></div>

    <p class="tx">Na dashboardzie CliC:ME skala kolorystyczna jest nakładana na baselayer mapy (ląd, drogi, granice, etykiety) z <strong>opacity 0.75</strong> (75%). Oznacza to, że kolory palety bledną o ~25% względem swoich wartości źródłowych - tło mapy przebija się przez warstwę danych.</p>

    <div class="card">
      <div class="lbl">Porównanie: paleta źródłowa vs wygląd na mapie</div>
      <div style="display:flex;gap:3px;margin-bottom:10px" id="opacity-compare"></div>
      <p class="tx">Górny rząd: pełne kolory z palety. Dolny: po nałożeniu na baselayer z opacity 0.75. Dlatego paleta musi być intensywniejsza niż docelowy efekt wizualny na mapie.</p>
    </div>

    <div class="card">
      <div class="lbl">Efektywne <span class="de-fix">dE</span> na mapie</div>
      <p class="tx">Po nałożeniu opacity 0.75 na tło lądu (<span style="white-space:nowrap"><span class="csw" style="background:#fffdfb"></span>&nbsp;<code>#fffdfb</code></span>), efektywne różnice percepcyjne spadają średnio o ~25%. Obliczone wartości dla każdej strefy skali:</p>
      <div class="grid2">
        <div class="zone-blue"><div class="zt">Dark blue (idx 0-9)</div><div class="zone-val">Paleta: dE = 4.9<br>Na mapie: <strong>dE = 3.6</strong> (blisko progu widoczności)</div></div>
        <div class="zone-blue"><div class="zt">Mid blue (idx 10-15)</div><div class="zone-val">Paleta: dE = 10.7<br>Na mapie: <strong>dE = 8.2</strong></div></div>
        <div class="zone-red"><div class="zt">Mid red (idx 17-22)</div><div class="zone-val">Paleta: dE = 10.9<br>Na mapie: <strong>dE = 10.4</strong></div></div>
        <div class="zone-red"><div class="zt">Dark red (idx 23-32)</div><div class="zone-val">Paleta: dE = 7.5<br>Na mapie: <strong>dE = 5.9</strong></div></div>
      </div>
    </div>

    <div class="co amber"><span class="co-icon">!</span> Najtrudniejsza strefa to ciemne niebieskie (idx 0-9) - efektywne dE = 3.6 jest blisko progu widoczności. To jest powód, dla którego korekty hue w sekcji 05 są tak istotne: bez nich te stepy byłyby praktycznie nierozróżnialne na mapie.</div>

    <p class="tx">Na rzeczywistej mapie dane nie tworzą płynnych, odseparowanych stref - niebieskie i czerwone pixele sąsiadują ze sobą bezpośrednio, tworząc mozaikę. Jest to wynik zarówno natury danych (migracja to zjawisko lokalne, wartości zmieniają się z pixela na pixel), jak i <strong>ograniczeń technologicznych</strong>: nie ma możliwości nałożenia borderów ani separatorów na poszczególne pixele danych. Pixel o wartości -200 może leżeć bezpośrednio obok pixela o wartości +150.</p>

    <p class="tx">To sprawia, że <strong>rozróżnialność sąsiednich stepów jest jeszcze ważniejsza</strong> niż sugerują same wartości dE - oko musi odczytać kierunek i intensywność z pojedynczego pixela w otoczeniu pixeli o potencjalnie odwrotnym znaku. Hue shift (sekcja 05) i wysoka separacja dE w mid-zone pomagają: nawet pojedynczy pixel ma wystarczająco odmienny kolor, by odbiorca rozpoznał jego stronę skali bez porównywania z sąsiadami.</p>

    <p class="tx">Powyższe obliczenia dotyczą baselayera lądu (<span style="white-space:nowrap"><span class="csw" style="background:#fffdfb"></span>&nbsp;<code>#fffdfb</code></span>). Na tle wód (<span style="white-space:nowrap"><span class="csw" style="background:#effafb"></span>&nbsp;<code>#effafb</code></span>) i dróg (<span style="white-space:nowrap"><span class="csw" style="background:#ffcc88"></span>&nbsp;<code>#ffcc88</code></span>) wartości będą się różnić. Kolory baselayera mogą być korygowane w kolejnym etapie prac.</p>
  </div>

  <!-- ===== 07 ===== -->
  <div class="sec" id="mosaic">
    <div class="sec-head"><span class="sec-num">07</span><h2>Symulacja mozaiki na mapie</h2></div>

    <p class="tx">Poniżej symulacja wizualna oddająca sposób, w jaki skala kolorystyczna prezentuje się na baselayerze mapy. Każdy kwadrat to jeden pixel danych nałożony z opacity 0.75 na tło lądu (<span style="white-space:nowrap"><span class="csw" style="background:#fffdfb"></span>&nbsp;<code>#fffdfb</code></span>). Białe luki to brak danych - baselayer przebija się w pełni. Kluczowe: niebieskie i czerwone pixele mieszają się przestrzennie, dokładnie jak na rzeczywistej mapie - nie ma czystego rozdzielenia stref.</p>

    <div class="card" style="padding:12px;overflow:hidden">
      <div class="lbl">Symulacja - widok mozaikowy (opacity 0.75 na baselayerze)</div>
      <canvas id="mosaic-canvas" style="width:100%;border-radius:6px;display:block;margin-bottom:14px"></canvas>
      <p class="tx"><strong>Szary delikatnie wybija się poza baselayer</strong> - i o to chodzi. Wartości bliskie zeru (strefa neutralna) nie skupiają uwagi użytkownika, bo są prawie niewidoczne na tle mapy. Oko automatycznie je pomija i skupia się na kolorowych regionach z istotnymi danymi.</p>
      <p class="tx"><strong>Brak czystego rozdzielenia:</strong> niebieskie i czerwone pixele leżą bezpośrednio obok siebie, tworząc mozaikę. Dlatego każdy pixel musi „bronić się sam" - kolor musi być wystarczająco odmienny, by odbiorca rozpoznał jego stronę skali bez porównywania z sąsiadami.</p>
      <p class="tx"><strong>Opacity 0.75:</strong> kolory tracą ~25% intensywności względem palety źródłowej. W ciemnej strefie niebieskiej (idx 0-9, efektywne dE=3.6) sąsiednie stepy zlewają się przy małym powiększeniu - kompromis wynikający z ograniczeń gamutu sRGB.</p>
    </div>

  </div>

  <!-- ===== 08 ===== -->
  <div class="sec" id="result">
    <div class="sec-head"><span class="sec-num">08</span><h2>Paleta końcowa</h2></div>

    <p class="tx">Opracowanie powstało na podstawie mapy migracyjnej, ale nie jest to skala tylko dla tej mapy. Ogólne założenia przyjęte w tym opracowaniu będą transponowane na wszystkie mapy w dashboardzie CliC:ME - z dalszymi ewentualnymi korektami zakresów i progów dla innych scope'ów i ich zmiennych.</p>

    <div style="margin-bottom:18px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
        <div class="grad-label" style="margin-bottom:0">Paleta końcowa - 33 stepy</div>
        <span class="tbl-toggle" id="hex-toggle-btn" onclick="toggleHexTable()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="rgba(245,158,11,0.7)" stroke-width="2.5" style="vertical-align:-1px"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg> Pokaż pełną tabelę</span>
      </div>
      <div id="hex-table-wrap" style="display:none;margin-bottom:12px">
        <div class="card" style="margin-top:0;margin-bottom:0">
          <p class="tx" style="font-size:13px;color:rgba(255,255,255,0.3);margin-bottom:12px">Kolory poniżej to wartości źródłowe palety. Na mapie nakładane z <strong>opacity 0.75</strong> na baselayer - przeglądarka blenduje automatycznie. Kliknij w kosteczkę lub wartość, żeby skopiować do schowka.</p>
          <div style="display:grid;grid-template-columns:32px 1fr 1fr;gap:0;font-size:12px;font-family:var(--mono)">
            <div style="padding:6px 5px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">idx</div>
            <div style="padding:6px 5px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">Hex (pełny kolor)</div>
            <div style="padding:6px 5px;color:rgba(255,255,255,0.3);font-weight:700;border-bottom:1px solid rgba(255,255,255,0.08)">Render na mapie</div>
          </div>
          <div id="hex-table"></div>
          <div style="text-align:center;padding-top:14px">
            <span class="tbl-toggle" onclick="toggleHexTable();document.getElementById('result').scrollIntoView({behavior:'smooth',block:'start'})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="rgba(245,158,11,0.7)" stroke-width="2.5" style="vertical-align:-1px"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg> Ukryj tabelę</span>
          </div>
        </div>
      </div>
      <div class="grad" id="g-final" style="height:48px"></div>
      <div class="grad-ends"><span>-1000 (wart. ujemne)</span><span class="neutral">NEUTRAL</span><span>+1000 (wart. dodatnie)</span></div>
    </div>

    <div class="card">
      <div class="lbl">Profil L* (jasność) i C* (chroma)</div>
      <svg id="svg-lc" width="540" height="120" style="display:block"></svg>
      <p class="note-10">Biała linia: jasność (L*) - symetryczny profil ze szczytem na szarym (L*=94). Fioletowa przerywana: chroma (C*) - szary ma C*=0, co wizualnie separuje strony.</p>
    </div>

    <div class="card">
      <div class="lbl"><span class="de-fix">dE</span> między sąsiednimi stepami</div>
      <svg id="svg-de" width="540" height="90" style="display:block"></svg>
      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:rgba(52,211,153,0.7)"></div><span class="legend-text">dE 5+ (oczywiste)</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:rgba(251,191,36,0.7)"></div><span class="legend-text">dE 3-5 (widoczne)</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:rgba(239,68,68,0.7)"></div><span class="legend-text">dE poniżej 3</span></div>
      </div>
      <p class="note-10" style="margin-top:8px">Wysokie słupki przy idx 15-16 i 16-17 to przejścia kolor/szary (dE=45.8 i 51.7) - celowy ostry próg oddzielający strony.</p>
    </div>

    <div class="grid4">
      <div class="card stat"><div class="stat-val">33</div><div class="stat-lbl">Steps</div></div>
      <div class="card stat"><div class="stat-val">10.8</div><div class="stat-lbl">Avg <span class="de-fix">dE</span> mid (paleta)</div></div>
      <div class="card stat"><div class="stat-val">9.3</div><div class="stat-lbl">Avg <span class="de-fix">dE</span> mid (mapa)</div></div>
      <div class="card stat"><div class="stat-val">0.75</div><div class="stat-lbl">Opacity</div></div>
    </div>

    <div class="card">
      <div class="lbl">Mapowanie wartości na kolory (rozkład równomierny, -1K do +1K)</div>
      <div style="display:flex;gap:1px;align-items:end;margin-bottom:4px" id="breakpoint-strip"></div>
      <div style="display:flex;gap:1px;margin-bottom:2px" id="breakpoint-vals"></div>
      <div style="display:flex;gap:2px;margin-bottom:10px;margin-top:4px" id="breakpoint-zones"></div>
      <p class="tx" style="margin-top:20px">Roboczy zakres danych: -1000 do +1000. Strefa neutralna to -60 do +60 - szary <span style="white-space:nowrap"><span class="csw" style="background:#EDEDED"></span>&nbsp;<code>#EDEDED</code></span> (idx 16) mapuje wartość 0. Kolory po obu stronach rozłożone równomiernie: 16 niebieskich od -1000 do -60, 16 czerwonych od +60 do +1000, z krokiem ~62.67 jednostki.</p>
      <p class="tx">Strefy <strong>dark</strong> (idx 0-9, 23-32) osiągają efektywne dE 3.6 / 5.9 na mapie - blisko progu widoczności. Strefy <strong>mid</strong> (idx 10-15, 17-22) dzięki optymalizacji hue: dE 8.2 / 10.4 - komfortowo powyżej. Docelowo progi danych będą przypisywane automatycznie per scope i variable.</p>
    </div>

    <div class="co green"><span class="co-icon">✓</span> Sama zmiana ze skali zielono-czerwonej na niebiesko-czerwoną to dobry kierunek w kontekście dostępności - skala z osią jasności jako głównym nośnikiem informacji jest znacznie czytelniejsza dla osób z zaburzeniami widzenia barw czerwono-zielonych.</div>

  </div>

  <!-- ===== 09 ===== -->
  <div class="sec" id="subscales">
    <div class="sec-head"><span class="sec-num">09</span><h2>Adaptacja skali dla scope'ów o niepełnym zakresie</h2></div>

    <p class="tx">Pełna paleta 33 stepów to master scale - zaprojektowana dla danych dywergentnych (od minus do plus przez zero). W praktyce poszczególne scope'y i zmienne dashboardu CliC:ME operują na wycinkach tej skali: tylko wartości dodatnie (np. 0-100%), tylko ujemne, albo wąski zakres wokół jednego końca. Zasada jest prosta: <strong>szary <span style="white-space:nowrap"><span class="csw" style="background:#EDEDED"></span>&nbsp;<code>#EDEDED</code></span> (idx 16) zawsze oznacza wartość bazową/zerową</strong>, a scope bierze odpowiedni fragment palety.</p>

    <div class="card">
      <div class="lbl">Tylko wartości dodatnie (0 → max) - idx 16-32, 17 stepów</div>
      <div style="display:flex;gap:1px;align-items:end;margin-bottom:4px" id="sub-pos-strip"></div>
      <div style="display:flex;justify-content:space-between;font-size:8px;color:rgba(255,255,255,0.3);font-family:var(--mono)">
        <span>0</span><span>max</span>
      </div>
      <p class="tx" style="margin-top:8px">Np. dane procentowe 0-100%. Szary = brak zjawiska, ciemny czerwony = maksymalna intensywność. Pełne 17 stepów strony czerwonej zachowuje oryginalne przejścia dE.</p>
    </div>

    <div class="card">
      <div class="lbl">Tylko wartości ujemne (min → 0) - idx 0-16, 17 stepów</div>
      <div style="display:flex;gap:1px;align-items:end;margin-bottom:4px" id="sub-neg-strip"></div>
      <div style="display:flex;justify-content:space-between;font-size:8px;color:rgba(255,255,255,0.3);font-family:var(--mono)">
        <span>min</span><span>0</span>
      </div>
      <p class="tx" style="margin-top:8px">Np. spadki, odpływy - im ciemniejszy niebieski, tym silniejsze zjawisko. Szary po prawej = wartość bazowa.</p>
    </div>

    <div class="card">
      <div class="lbl">Wąski zakres dodatni (0 → 50% max) - idx 16-24, 9 stepów</div>
      <div style="display:flex;gap:1px;align-items:end;margin-bottom:4px" id="sub-narrow-strip"></div>
      <div style="display:flex;justify-content:space-between;font-size:8px;color:rgba(255,255,255,0.3);font-family:var(--mono)">
        <span>0</span><span>50% max</span>
      </div>
      <p class="tx" style="margin-top:8px">Przy wąskim wycinku mniej stepów = wyższe dE między sąsiednimi = lepsza czytelność na mapie. Kompromisem jest mniejsza granulacja danych.</p>
    </div>

    <div class="card">
      <div class="lbl">Wąski zakres ujemny (50% min → 0) - idx 8-16, 9 stepów</div>
      <div style="display:flex;gap:1px;align-items:end;margin-bottom:4px" id="sub-narrow-neg-strip"></div>
      <div style="display:flex;justify-content:space-between;font-size:8px;color:rgba(255,255,255,0.3);font-family:var(--mono)">
        <span>50% min</span><span>0</span>
      </div>
      <p class="tx" style="margin-top:8px">Lustrzany odpowiednik wąskiego zakresu czerwonego. Szary po prawej = wartość bazowa, ciemniejszy niebieski = silniejsze zjawisko ujemne.</p>
    </div>

    <div class="card">
      <div class="lbl">Symulacja mozaiki - positive-only vs negative-only (opacity 0.75 na baselayerze)</div>
      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <div style="font-size:9px;font-weight:700;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">Positive-only (0 → max)</div>
          <canvas id="mosaic-pos" style="width:100%;border-radius:6px;border:1px solid rgba(255,255,255,0.06)"></canvas>
        </div>
        <div style="flex:1">
          <div style="font-size:9px;font-weight:700;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">Negative-only (min → 0)</div>
          <canvas id="mosaic-neg" style="width:100%;border-radius:6px;border:1px solid rgba(255,255,255,0.06)"></canvas>
        </div>
      </div>
      <p class="tx" style="margin-top:10px">Obie mozaiki renderowane z opacity 0.75 na baselayerze lądu. Białe luki = brak danych. Kolory wycinka zachowują identyczne właściwości percepcyjne jak w pełnej skali - szary zawsze separuje strefę zerową.</p>
    </div>

    <div class="co amber"><span class="co-icon">!</span> Przy bardzo wąskich wycinkach (poniżej 8 stepów) warto rozważyć resampling - ponowne rozłożenie kolorów z większym krokiem dE, zamiast brać fragment palety 1:1. To wymaga osobnej kalibracji per scope.</div>
  </div>

  <div class="toast" id="copy-toast"></div>

  <!-- FOOTER -->
  <div class="footer">
    CliC:ME Dashboard - Divergent Color Scale M1 - CIE Lab optimised<br>
    33 discrete steps - Opacity 0.75 - Breakpoints -1000/+1000<br>
    Made by <a href="https://autentika.com" style="color:rgba(255,255,255,0.35);text-decoration:underline;text-underline-offset:2px" target="_blank">Autentika</a>
  </div>

</div>

<script>
// === COLOR MATH ===
const FIN=["#0C0343","#070B51","#001361","#001A6E","#00227A","#002B88","#003596","#003FA2","#004AAE","#0054B8","#0061C6","#0074D9","#0089F0","#009EFC","#00B2FF","#4DC3FF","#EDEDED","#FEA274","#F98657","#EF663D","#E64328","#DC1915","#D7000B","#D0000E","#C20011","#B50011","#A70012","#960011","#840012","#730011","#610010","#4F010E","#3E040B"];

function h2r(h){h=h.replace('#','');return[parseInt(h.slice(0,2),16),parseInt(h.slice(2,4),16),parseInt(h.slice(4,6),16)];}
function sLin(c){c/=255;return c<=0.04045?c/12.92:((c+0.055)/1.055)**2.4;}
function r2lab(r,g,b){const rl=sLin(r),gl=sLin(g),bl=sLin(b);const x=(0.4124564*rl+0.3575761*gl+0.1804375*bl)/0.95047,y=0.2126729*rl+0.7151522*gl+0.072175*bl,z=(0.0193339*rl+0.119192*gl+0.9503041*bl)/1.08883;const f=t=>t>0.008856?Math.cbrt(t):7.787*t+16/116;return[116*f(y)-16,500*(f(x)-f(y)),200*(f(y)-f(z))];}
function lch(hex){const[L,a,b]=r2lab(...h2r(hex));return{L,C:Math.sqrt(a*a+b*b),h:((Math.atan2(b,a)*180/Math.PI)+360)%360};}
function dE(h1,h2){const a=r2lab(...h2r(h1)),b=r2lab(...h2r(h2));return Math.sqrt(a.reduce((s,v,i)=>s+(v-b[i])**2,0));}

// === GRADIENT HELPER ===
function makeGrad(id,colors,h){
  const el=document.getElementById(id);if(!el)return;
  const g=colors.map((c,i)=>c+' '+(i/(colors.length-1)*100).toFixed(1)+'%').join(', ');
  el.style.background='linear-gradient(to right, '+g+')';
  if(h)el.style.height=h+'px';
}

// === SWATCH HELPER ===
function makeSw(id,colors){
  const el=document.getElementById(id);if(!el)return;
  el.innerHTML=colors.map(c=>'<div class="sw-item" style="background:'+c+'"></div>').join('');
}

// === HUE STRIP ===
function makeHue(id,colors){
  const el=document.getElementById(id);if(!el)return;
  el.innerHTML=colors.map(c=>{const info=lch(c);return'<div class="hs-item"><div class="hs-swatch" style="background:'+c+'"></div><div class="hs-val">'+info.h.toFixed(0)+'</div></div>';}).join('');
}

// === INIT ===
document.addEventListener('DOMContentLoaded',()=>{
  // Nav
  const tabs=[['proposals','Propozycje LISER'],['vs02','Wybór VS-02'],['extension','Rozszerzenie zakresu'],['perception','Percepcja kolorów'],['lut','Korekty LUT'],['opacity','Opacity'],['mosaic','Symulacja'],['result','Paleta końcowa'],['subscales','Niepełne zakresy']];
    const nav=document.getElementById('nav');
  const navButtons={};
  tabs.forEach(([id,lbl])=>{
    const b=document.createElement('button');b.textContent=lbl;b.dataset.s=id;
    b.onclick=()=>{nav.querySelectorAll('button').forEach(x=>x.classList.remove('on'));b.classList.add('on');document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'start'});};
    nav.appendChild(b);
    navButtons[id]=b;
  });
  nav.querySelector('button').classList.add('on');

  // Scroll-tracking: highlight when section header passes near top
  const sectionIds=tabs.map(t=>t[0]);
  function updateNav(){
    let current=sectionIds[0];
    let progress=0;
    const scrollPos=window.scrollY+110;
    const atBottom=window.innerHeight+window.scrollY>=document.body.offsetHeight-50;
    if(atBottom){
      for(let i=sectionIds.length-1;i>=0;i--){
        if(document.getElementById(sectionIds[i])){current=sectionIds[i];break;}
      }
      progress=100;
    } else {
      for(let i=sectionIds.length-1;i>=0;i--){
        const el=document.getElementById(sectionIds[i]);
        if(el && el.offsetTop<=scrollPos){
          current=sectionIds[i];
          // Calculate progress through this section
          const nextEl=i<sectionIds.length-1?document.getElementById(sectionIds[i+1]):null;
          if(nextEl){
            const secH=nextEl.offsetTop-el.offsetTop;
            if(secH>0) progress=Math.min(100,Math.max(0,((scrollPos-el.offsetTop)/secH)*100));
          } else {
            const secH=document.body.offsetHeight-el.offsetTop;
            const scrolled=scrollPos-el.offsetTop;
            if(secH>0) progress=Math.min(100,Math.max(0,(scrolled/secH)*100));
          }
          break;
        }
      }
    }
    nav.querySelectorAll('button').forEach(x=>{x.classList.remove('on');x.style.setProperty('--prog','0%');});
    if(navButtons[current]){
      navButtons[current].classList.add('on');
      navButtons[current].style.setProperty('--prog',progress+'%');
    }
  }
  window.addEventListener('scroll',updateNav);

  // Gradients
  makeGrad('g-vs01',['#000066','#D9D9D9','#E30613']);
  makeGrad('g-vs02',['#000066','#0099FF','#D9D9D9','#E30613','#8D1C0C']);
  makeGrad('g-vs03',['#000066','#0099FF','#73E6D0','#D9D9D9','#E673AB','#E30613','#8D1C0C']);
  makeGrad('g-vs03exp',['#00EDBF','#000066','#0099FF','#D9D9D9','#E30613','#8D1C0C','#FF3BA2']);
  makeGrad('g-vs01b',['#000066','#D9D9D9','#E30613']);
  makeGrad('g-vs02b',['#000066','#0099FF','#D9D9D9','#E30613','#8D1C0C']);
  makeGrad('g-vs03b',['#000066','#0099FF','#73E6D0','#D9D9D9','#E673AB','#E30613','#8D1C0C']);
  makeGrad('g-vs03expb',['#00EDBF','#000066','#0099FF','#D9D9D9','#E30613','#8D1C0C','#FF3BA2']);
  makeGrad('g-final',FIN);

  // Swatches
  makeSw('sw-blue-before',['#000033','#00023D','#000447','#000451','#00035B','#000066']);
  makeSw('sw-blue-after',FIN.slice(0,10));
  makeSw('sw-red-before',['#8D1C0C','#701609','#541007','#380B04','#1C0502','#0E0201']);
  makeSw('sw-red-after',FIN.slice(23));
  makeSw('sw-lut-blue-before',['#0C0343','#001361','#00227A','#003596','#004AAE','#0061C6','#0089F0','#00B2FF']);
  makeSw('sw-lut-red-before',['#E30613','#D0000E','#B50011','#960011','#730011','#4F010E','#3E040B']);

  // Hue strips
  makeHue('hs-blue-after',FIN.slice(0,16));
  makeHue('hs-red-after',FIN.slice(17));

  // Opacity comparison
  const opIdx=[2,6,10,13,15,16,17,19,22,26,30];
  const opEl=document.getElementById('opacity-compare');
  opEl.innerHTML=opIdx.map(i=>{const c=FIN[i];return'<div style="flex:1;text-align:center"><div style="height:24px;background:'+c+';border-radius:3px;margin-bottom:2px"></div><div style="height:24px;border-radius:3px;position:relative;overflow:hidden;background:#fffdfb"><div style="position:absolute;inset:0;background:'+c+';opacity:0.75"></div></div></div>';}).join('')+'<div style="display:flex;flex-direction:column;justify-content:center;margin-left:4px;flex-shrink:0"><div style="font-size:8px;color:rgba(255,255,255,0.3)">Paleta</div><div style="font-size:8px;color:rgba(255,255,255,0.3);margin-top:8px">Na mapie</div></div>';

  // Breakpoint strip
  const bpEl=document.getElementById('breakpoint-strip');
  const bpVals=document.getElementById('breakpoint-vals');
  bpEl.innerHTML=FIN.map((c,i)=>{
    const isGray=i===16,isAdj=i===15||i===17;
    const h=isGray?28:isAdj?22:16;
    const brd=isGray?'1.5px solid rgba(255,255,255,0.3)':isAdj?'1px solid rgba(255,255,255,0.12)':'none';
    return'<div style="flex:1"><div style="height:'+h+'px;background:'+c+';border-radius:2px;border:'+brd+'"></div></div>';
  }).join('');
  const labels={0:'-1000',15:'-60',16:'0',17:'+60',32:'+1000'};
  bpVals.innerHTML=FIN.map((c,i)=>{
    const lbl=labels[i]||'';
    const w=i===16?'700':'400';
    const col=i===16?'rgba(255,255,255,0.5)':'rgba(255,255,255,0.3)';
    return'<div style="flex:1;text-align:center;font-size:7px;font-family:var(--mono);color:'+col+';font-weight:'+w+'">'+lbl+'</div>';
  }).join('');
  // zone indicators
  const zones=[
    {start:0,end:9,label:'dark blue',color:'rgba(96,165,250,0.8)',bg:'rgba(59,130,246,0.06)',brd:'rgba(59,130,246,0.15)'},
    {start:10,end:15,label:'mid blue',color:'rgba(96,165,250,0.8)',bg:'rgba(59,130,246,0.06)',brd:'rgba(59,130,246,0.15)'},
    {start:16,end:16,label:'neutral',color:'rgba(255,255,255,0.5)',bg:'rgba(255,255,255,0.04)',brd:'rgba(255,255,255,0.1)'},
    {start:17,end:22,label:'mid red',color:'rgba(248,113,113,0.8)',bg:'rgba(239,68,68,0.06)',brd:'rgba(239,68,68,0.15)'},
    {start:23,end:32,label:'dark red',color:'rgba(248,113,113,0.8)',bg:'rgba(239,68,68,0.06)',brd:'rgba(239,68,68,0.15)'}
  ];
  const bpZones=document.getElementById('breakpoint-zones');
  bpZones.innerHTML=zones.map(z=>{
    const span=z.end-z.start+1;
    return'<div style="flex:'+span+';text-align:center;font-size:8px;font-weight:700;font-family:var(--mono);color:'+z.color+';background:'+z.bg+';border:1px solid '+z.brd+';border-radius:4px;padding:3px 0;letter-spacing:0.03em">'+z.label+'</div>';
  }).join('');

  // SVG: L*/C* chart
  const svgLC=document.getElementById('svg-lc');
  let html='';
  [0,25,50,75,100].forEach(v=>{const y=16+(1-v/100)*86;html+='<line x1="34" y1="'+y+'" x2="528" y2="'+y+'" stroke="rgba(255,255,255,0.06)"/><text x="30" y="'+(y+3)+'" font-size="7" fill="rgba(255,255,255,0.25)" text-anchor="end" font-family="var(--mono)">'+v+'</text>';});
  // C* line
  let pathC='';FIN.forEach((c,i)=>{const info=lch(c);const px=34+(i/32)*494,py=16+(1-info.C/100)*86;pathC+=(i?'L':'M')+px.toFixed(1)+','+py.toFixed(1);});
  html+='<path d="'+pathC+'" fill="none" stroke="rgba(168,85,247,0.4)" stroke-width="1.5" stroke-dasharray="4,3"/>';
  // L* line
  let pathL='';FIN.forEach((c,i)=>{const info=lch(c);const px=34+(i/32)*494,py=16+(1-info.L/100)*86;pathL+=(i?'L':'M')+px.toFixed(1)+','+py.toFixed(1);});
  html+='<path d="'+pathL+'" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2"/>';
  // dots
  FIN.forEach((c,i)=>{const info=lch(c);const px=34+(i/32)*494,py=16+(1-info.L/100)*86;html+='<circle cx="'+px+'" cy="'+py+'" r="2.5" fill="'+c+'" stroke="rgba(255,255,255,0.3)" stroke-width="0.5"/>';});
  html+='<text x="528" y="12" font-size="7" fill="rgba(255,255,255,0.3)" text-anchor="end">solid: L*     dashed: C*</text>';
  svgLC.innerHTML=html;

  // SVG: dE chart
  const svgDE=document.getElementById('svg-de');
  let html2='';
  [5,10,15].forEach(v=>{const y=14+(1-v/55)*62;html2+='<line x1="34" y1="'+y+'" x2="528" y2="'+y+'" stroke="rgba(255,255,255,0.05)"/><text x="30" y="'+(y+3)+'" font-size="7" fill="rgba(255,255,255,0.2)" text-anchor="end" font-family="var(--mono)">'+v+'</text>';});
  const jndY=14+(1-3/55)*62;
  html2+='<line x1="34" y1="'+jndY+'" x2="528" y2="'+jndY+'" stroke="rgba(239,68,68,0.3)" stroke-dasharray="3,3"/>';
  html2+='<text x="530" y="'+(jndY+3)+'" font-size="6" fill="rgba(239,68,68,0.5)">JND</text>';
  FIN.slice(0,-1).forEach((c,j)=>{
    const d=dE(FIN[j],FIN[j+1]);const bh=(d/55)*62;const x=34+(j/32)*494;const bw=494/32-1;
    const isGr=j===15||j===16;
    let col='rgba(52,211,153,0.6)';if(isGr)col='rgba(255,255,255,0.15)';else if(d<3)col='rgba(239,68,68,0.6)';else if(d<5)col='rgba(251,191,36,0.6)';
    html2+='<rect x="'+x+'" y="'+(14+62-bh)+'" width="'+bw+'" height="'+bh+'" fill="'+col+'" rx="1"/>';
  });
  svgDE.innerHTML=html2;

  // === MOSAIC SIMULATION ===
  const cv=document.getElementById('mosaic-canvas');
  if(cv){
    const px=10, gap=0, step=px+gap;
    const cols=Math.floor(540/step), rows=32;
    cv.width=cols*step; cv.height=rows*step;
    cv.style.imageRendering='pixelated';
    const ctx=cv.getContext('2d');
    const bg=[255,253,251]; // #fffdfb baselayer

    // Seeded random for reproducibility
    let seed=42;
    function rand(){seed=(seed*16807+0)%2147483647;return(seed-1)/2147483646;}
    function randN(){return(rand()+rand()+rand()-1.5)*1.15;} // approx normal

    // Generate a "field" that mixes blue and red chaotically, like real migration data
    // Multiple overlapping blobs of different signs create the mosaic effect
    const blobs=[];
    for(let i=0;i<35;i++){
      blobs.push({
        x:rand(), y:rand(),
        r:0.05+rand()*0.2,
        sign:rand()<0.45?-1:1, // slight blue bias
        strength:0.3+rand()*0.8
      });
    }

    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const nx=c/cols, ny=r/rows;

        // Coverage: ~70% has data, 30% is baselayer showing through
        const covNoise=0.3*Math.sin(nx*9.3+ny*5.1)*Math.cos(ny*7.2-nx*4.8);
        if(rand()>(0.68+covNoise)){
          ctx.fillStyle='#fffdfb';
          ctx.fillRect(c*step,r*step,px,px);
          continue;
        }

        // Compute value from overlapping blobs + noise
        let val=0;
        for(const b of blobs){
          const dx=nx-b.x, dy=ny-b.y;
          const dist=Math.sqrt(dx*dx+dy*dy);
          if(dist<b.r){
            val+=b.sign*b.strength*(1-dist/b.r);
          }
        }
        // Add pixel-level noise (real data is noisy)
        val+=0.15*randN();
        val=Math.max(-1,Math.min(1,val));

        // Map value to palette index
        // WIDE neutral zone: ~35% of range maps to gray
        let idx;
        if(Math.abs(val)<0.18){
          idx=16; // neutral gray - this is the key: lots of near-zero values
        } else if(val<0){
          // Scale -0.18..-1 → idx 15..0
          const t=(Math.abs(val)-0.18)/(1-0.18);
          idx=15-Math.round(t*15);
          idx=Math.max(0,Math.min(15,idx));
        } else {
          const t=(val-0.18)/(1-0.18);
          idx=17+Math.round(t*15);
          idx=Math.max(17,Math.min(32,idx));
        }

        // Blend palette color with baselayer at opacity 0.75
        const hx=FIN[idx];
        const pr=parseInt(hx.slice(1,3),16),pg=parseInt(hx.slice(3,5),16),pb=parseInt(hx.slice(5,7),16);
        const a=0.75;
        const br=Math.round(pr*a+bg[0]*(1-a));
        const bg2=Math.round(pg*a+bg[1]*(1-a));
        const bb=Math.round(pb*a+bg[2]*(1-a));
        ctx.fillStyle='rgb('+br+','+bg2+','+bb+')';
        ctx.fillRect(c*step,r*step,px,px);
      }
    }

    // Add some "road" lines (thin lines in baselayer-ish color)
    ctx.strokeStyle='rgba(200,180,140,0.3)';
    ctx.lineWidth=1.5;
    ctx.beginPath();
    ctx.moveTo(0,rows*step*0.35);
    ctx.bezierCurveTo(cols*step*0.3,rows*step*0.32, cols*step*0.6,rows*step*0.4, cols*step,rows*step*0.38);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(cols*step*0.45,0);
    ctx.bezierCurveTo(cols*step*0.47,rows*step*0.3, cols*step*0.5,rows*step*0.6, cols*step*0.48,rows*step);
    ctx.stroke();

    // Add a subtle "border" line
    ctx.strokeStyle='rgba(120,120,120,0.2)';
    ctx.lineWidth=1;
    ctx.beginPath();
    ctx.moveTo(cols*step*0.25,0);
    ctx.bezierCurveTo(cols*step*0.28,rows*step*0.4, cols*step*0.35,rows*step*0.6, cols*step*0.3,rows*step);
    ctx.stroke();
  }

  // === SUBSCALE STRIPS ===
  function makeSubStrip(elId, indices){
    const el=document.getElementById(elId);
    if(!el) return;
    const bg=[255,253,251];
    el.innerHTML=indices.map(i=>{
      const c=FIN[i];
      const pr=parseInt(c.slice(1,3),16),pg=parseInt(c.slice(3,5),16),pb=parseInt(c.slice(5,7),16);
      const a=0.75;
      const br=Math.round(pr*a+bg[0]*(1-a)),bg2=Math.round(pg*a+bg[1]*(1-a)),bb=Math.round(pb*a+bg[2]*(1-a));
      const eff='rgb('+br+','+bg2+','+bb+')';
      const isGray=i===16;
      const h=isGray?24:16;
      const brd=isGray?'1.5px solid rgba(255,255,255,0.3)':'none';
      return'<div style="flex:1"><div style="height:'+h+'px;background:'+eff+';border-radius:2px;border:'+brd+'"></div></div>';
    }).join('');
  }
  makeSubStrip('sub-pos-strip',Array.from({length:17},(_,i)=>i+16));

  // === COPY TOAST ===
  const toast=document.getElementById('copy-toast');
  let toastTimer;
  function showToast(msg,e){
    toast.textContent=msg;
    toast.style.left=(e.clientX+12)+'px';
    toast.style.top=(e.clientY-30)+'px';
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer=setTimeout(()=>toast.classList.remove('show'),1200);
  }
  function copyVal(val,e){
    navigator.clipboard.writeText(val).then(()=>showToast('skopiowano '+val+' do schowka',e));
  }
  window.copyVal=copyVal;

  // === HEX TABLE TOGGLE ===
  const eyeOpen='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="rgba(245,158,11,0.7)" stroke-width="2.5" style="vertical-align:-1px"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
  const eyeShut='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="rgba(245,158,11,0.7)" stroke-width="2.5" style="vertical-align:-1px"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';
  window.toggleHexTable=function(){
    const t=document.getElementById('hex-table-wrap'),b=document.getElementById('hex-toggle-btn');
    const isOpen=t.style.display!=='none';
    t.style.display=isOpen?'none':'block';
    b.innerHTML=isOpen?eyeOpen+' Pokaż pełną tabelę':eyeShut+' Ukryj tabelę';
    setTimeout(updateNav,50);
  };

  // === HEX TABLE ===
  const hexTable=document.getElementById('hex-table');
  if(hexTable){
    const bgR=255,bgG=253,bgB=251;
    hexTable.innerHTML=FIN.map((h,i)=>{
      const r=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),b=parseInt(h.slice(5,7),16);
      const er=Math.round(r*0.75+bgR*0.25),eg=Math.round(g*0.75+bgG*0.25),eb=Math.round(b*0.75+bgB*0.25);
      const eff='rgb('+er+','+eg+','+eb+')';
      const rgba='rgba('+r+','+g+','+b+',0.75)';
      const isN=i===16;
      const rowBg=isN?'background:rgba(255,255,255,0.03);':'';
      const brd='border-bottom:1px solid rgba(255,255,255,0.03);';
      return'<div style="display:grid;grid-template-columns:32px 1fr 1fr;gap:0;font-size:12px;font-family:var(--mono);'+brd+rowBg+'">'+
        '<div style="padding:5px;color:rgba(255,255,255,0.25)">'+i+'</div>'+
        '<div class="tbl-cell" style="padding:5px;display:flex;align-items:center;gap:6px" onclick="copyVal(\''+h+'\',event)" title="Kliknij by skopiować '+h+'"><span style="display:inline-block;width:18px;height:18px;border-radius:3px;background:'+h+';flex-shrink:0"></span><span style="color:rgba(255,255,255,0.55)">'+h+'</span></div>'+
        '<div class="tbl-cell" style="padding:5px;display:flex;align-items:center;gap:6px" onclick="copyVal(\''+rgba+'\',event)" title="Kliknij by skopiować '+rgba+'"><span style="display:inline-block;width:18px;height:18px;border-radius:3px;background:'+eff+';flex-shrink:0"></span><span style="color:rgba(255,255,255,0.45);font-size:11px">'+rgba+'</span></div>'+
        '</div>';
    }).join('');
  }
  makeSubStrip('sub-neg-strip',Array.from({length:17},(_,i)=>i));
  makeSubStrip('sub-narrow-strip',Array.from({length:9},(_,i)=>i+16));
  makeSubStrip('sub-narrow-neg-strip',Array.from({length:9},(_,i)=>i+8));

  // === MINI MOSAICS ===
  function makeMiniMosaic(canvasId, mode){
    const cv=document.getElementById(canvasId);
    if(!cv) return;
    const px=8, step=px;
    const cols=Math.floor(260/step), rows=22;
    cv.width=cols*step; cv.height=rows*step;
    cv.style.imageRendering='pixelated';
    const ctx=cv.getContext('2d');
    const bg=[255,253,251];

    let seed=mode==='pos'?73:137;
    function rand(){seed=(seed*16807+0)%2147483647;return(seed-1)/2147483646;}
    function randN(){return(rand()+rand()+rand()-1.5)*1.15;}

    const blobs=[];
    for(let i=0;i<25;i++){
      blobs.push({x:rand(),y:rand(),r:0.06+rand()*0.22,strength:0.2+rand()*0.9});
    }

    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const nx=c/cols, ny=r/rows;
        const covNoise=0.3*Math.sin(nx*9.3+ny*5.1)*Math.cos(ny*7.2-nx*4.8);
        if(rand()>(0.68+covNoise)){
          ctx.fillStyle='#fffdfb';
          ctx.fillRect(c*step,r*step,px,px);
          continue;
        }

        let val=0;
        for(const b of blobs){
          const dx=nx-b.x,dy=ny-b.y;
          const dist=Math.sqrt(dx*dx+dy*dy);
          if(dist<b.r) val+=b.strength*(1-dist/b.r);
        }
        val+=0.1*randN();
        val=Math.max(0,Math.min(1,val));

        let idx;
        if(val<0.12){
          idx=16;
        } else if(mode==='pos'){
          const t=(val-0.12)/(1-0.12);
          idx=17+Math.round(t*15);
          idx=Math.max(17,Math.min(32,idx));
        } else {
          const t=(val-0.12)/(1-0.12);
          idx=15-Math.round(t*15);
          idx=Math.max(0,Math.min(15,idx));
        }

        const hx=FIN[idx];
        const pr=parseInt(hx.slice(1,3),16),pg=parseInt(hx.slice(3,5),16),pb2=parseInt(hx.slice(5,7),16);
        const a=0.75;
        const br2=Math.round(pr*a+bg[0]*(1-a));
        const bg3=Math.round(pg*a+bg[1]*(1-a));
        const bb=Math.round(pb2*a+bg[2]*(1-a));
        ctx.fillStyle='rgb('+br2+','+bg3+','+bb+')';
        ctx.fillRect(c*step,r*step,px,px);
      }
    }
  }
  makeMiniMosaic('mosaic-pos','pos');
  makeMiniMosaic('mosaic-neg','neg');

  // --- Fade-in cards on scroll ---
  document.querySelectorAll('.card, .co').forEach(el=>el.classList.add('fade-in'));
  const fadeObs=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');fadeObs.unobserve(e.target);}});
  },{threshold:0.15});
  document.querySelectorAll('.fade-in').forEach(el=>fadeObs.observe(el));

  // --- Click-to-copy all hex codes + swatches ---
  document.querySelectorAll('code').forEach(el=>{
    const t=el.textContent.trim();
    if(/^#[0-9A-Fa-f]{6}$/.test(t)){
      el.style.cursor='pointer';
      el.title='Kliknij by skopiować';
      el.classList.add('hex-copy');
      el.addEventListener('click',(e)=>{
        navigator.clipboard.writeText(t).then(()=>showToast('skopiowano '+t+' do schowka',e));
      });
    }
  });
  document.querySelectorAll('.csw').forEach(el=>{
    const code=el.parentElement&&el.parentElement.querySelector('code');
    if(code){
      const hex=code.textContent.trim();
      el.title='Kliknij by skopiować '+hex;
      el.addEventListener('click',(e)=>{
        navigator.clipboard.writeText(hex).then(()=>showToast('skopiowano '+hex+' do schowka',e));
      });
    }
  });

  // --- Keyboard navigation ←→ ---
  document.addEventListener('keydown',(e)=>{
    if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return;
    if(e.key==='ArrowLeft'||e.key==='ArrowRight'){
      e.preventDefault();
      const active=document.querySelector('.nav button.on');
      let idx=active?sectionIds.indexOf(active.dataset.s):0;
      if(e.key==='ArrowLeft') idx=Math.max(0,idx-1);
      else idx=Math.min(sectionIds.length-1,idx+1);
      const el=document.getElementById(sectionIds[idx]);
      if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
    }
    if(e.key==='Home'){e.preventDefault();window.scrollTo({top:0,behavior:'smooth'});}
    if(e.key==='End'){e.preventDefault();window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});}
  });
});
</script>
</body>
</html>
